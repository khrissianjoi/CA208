if (self.CavalryLogger) { CavalryLogger.start_js(["JSrOn"]); }

__d("CometPhotoEditorAIProductTagSuggestionTriggerQuery.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"actorID"}],b=[{kind:"Variable",name:"id",variableName:"actorID"}],c={alias:null,args:null,kind:"ScalarField",name:"has_taggable_products",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"has_shared_catalog_segments",storageKey:null},e={alias:null,args:b,kind:"ScalarField",name:"additional_profile_shop_info",storageKey:null};return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"CometPhotoEditorAIProductTagSuggestionTriggerQuery",selections:[{alias:null,args:b,concreteType:"Page",kind:"LinkedField",name:"page",plural:!1,selections:[c,d],storageKey:null},e],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"CometPhotoEditorAIProductTagSuggestionTriggerQuery",selections:[{alias:null,args:b,concreteType:"Page",kind:"LinkedField",name:"page",plural:!1,selections:[c,d,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null},e]},params:{id:"3395615320518267",metadata:{},name:"CometPhotoEditorAIProductTagSuggestionTriggerQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("mediaAttachmentAreaTransform",["Promise","promiseDone","qex"],(function(a,b,c,d,e,f){"use strict";e.exports=a;var g=b("qex")._("1221850")===!0;function h(a){if(a.fileType==="PHOTO"){var b;b=k(a==null?void 0:(b=a.data)==null?void 0:b.tags);return{photo:babelHelpers["extends"]({},a.data,{tags:b})}}else if(a.fileType==="VIDEO")return{video:babelHelpers["extends"]({},a.data,{notify_when_processed:!0})};return null}function a(a,c,d){if(g){var e=[];for(var f in a.mediaUploadStatuses)e.push(a.mediaUploadStatuses[f].onFileComplete);b("promiseDone")(b("Promise").all(e).then(function(b){d(babelHelpers["extends"]({},c,{attachments:b.map(function(b){var c=b.attachmentID;if(b.attachmentType==="PHOTO")return{photo:babelHelpers["extends"]({id:c},i(c,a.mediaAttachments))};if(b.attachmentType==="VIDEO")return{video:babelHelpers["extends"]({id:c},j(c,a.mediaAttachments),{notify_when_processed:!0})}})}))}));return}if(a.mediaAttachments==null){d(c);return}d(babelHelpers["extends"]({},c,{attachments:a.mediaAttachments.map(function(a){return a.state==="UPLOADED"||a.state==="PREEXISTING"?h(a):null}).filter(Boolean)}))}function i(a,b){b=((b=b)!=null?b:[]).find(function(b){var c;return(b==null?void 0:(c=b.data)==null?void 0:c.id)===a||(b==null?void 0:b.state)==="UPLOADED"&&(b==null?void 0:b.fileType)==="PHOTO"&&(b==null?void 0:b.originalEntID)===a});if(b!=null&&b.fileType==="PHOTO"&&((b==null?void 0:b.state)==="UPLOADED"||(b==null?void 0:b.state)==="PREEXISTING")){var c;c=k(b==null?void 0:(c=b.data)==null?void 0:c.tags);return babelHelpers["extends"]({},b.data,{tags:c})}else return null}function j(a,b){b=((b=b)!=null?b:[]).find(function(b){var c;return(b==null?void 0:(c=b.data)==null?void 0:c.id)===a||(b==null?void 0:b.state)==="UPLOADED"&&(b==null?void 0:b.fileType)==="VIDEO"&&(b==null?void 0:b.entID)===a});if(b!=null&&b.fileType==="VIDEO"&&((b==null?void 0:b.state)==="UPLOADED"||(b==null?void 0:b.state)==="PREEXISTING"))return babelHelpers["extends"]({},b.data);else return null}function k(a){if(a==null)return;return a.map(function(a){if(a!=null){return babelHelpers["extends"]({},a,{taggee:{id:(a=a.taggee)==null?void 0:a.id}})}})}}),null);
__d("composerGetMessagesTransform",["mediaAttachmentAreaTransform"],(function(a,b,c,d,e,f){"use strict";e.exports=a;function a(a,c,d){return a.isGetMessagesPost===!0?a.mediaAttachments!=null?b("mediaAttachmentAreaTransform")(a,babelHelpers["extends"]({},c,{call_to_action_data:babelHelpers["extends"]({},c.call_to_action_data,{is_cta_share_post:!0,type:"MESSAGE_PAGE"})}),d):d(babelHelpers["extends"]({},c,{call_to_action_data:babelHelpers["extends"]({},c.call_to_action_data,{is_cta_share_post:!0,type:"MESSAGE_PAGE"})})):d(babelHelpers["extends"]({},c))}}),null);
__d("composerValidateGetMessagesMustContainMedia",["fbt"],(function(a,b,c,d,e,f,g){"use strict";e.exports=a;function a(a){var b=a.mediaAttachments||[];return a.isGetMessagesPost===!0&&b.length===0?g._("You cannot create a Send Message post without attaching media"):null}}),null);
__d("ProductTagUserActionType",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum").Mirrored(["ACCEPTED","REJECTED","IGNORED","USER_GENERATED","IMPLICIT_ACCEPTED"]);c=a;e.exports=c}),null);
__d("ProductTaggingAiEvaluationFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f){"use strict";a=b("getFalcoLogPolicy_DO_NOT_USE")("1744233");c=b("FalcoLoggerInternal").create("product_tagging_ai_evaluation",a);e.exports=c}),null);
__d("CometAIProductTagEvaluationLoggingUtils",["CometAIProductTagSuggestionsUtil.react","CometComposerProductTagUtils","ProductTagUserActionType","ProductTaggingAiEvaluationFalcoEvent"],(function(a,b,c,d,e,f){"use strict";f.logAIProductTagsEvaluationData=a;function g(a,c,d,e){a=a.filter(function(a){return!a?!1:a.x===d.x&&a.y===d.y&&a.taggee.id===d.productID}).length>0;c=c.includes(d.productID);var f=d.productScore;if(f===null||f===void 0)return"IGNORED";if(a){if(c)return"ACCEPTED";if(b("CometAIProductTagSuggestionsUtil.react").canUsePretagExperience(e)&&f<=b("CometComposerProductTagUtils").PRETAGGING_PRODUCT_THRESHOLD)return"IMPLICIT_ACCEPTED"}else if(c)return"REJECTED";return"IGNORED"}function h(a,b,c){var d=null;a=a.filter(function(a){return!a?!1:a.x.toFixed(2)===c.x.toFixed(2)&&a.y.toFixed(2)===c.y.toFixed(2)});var e=a.length>0;if(e){d=(a=a[0])==null?void 0:a.taggee.id}a=Boolean(((b=b==null?void 0:(a=b.filter(function(a){return c.x===a.x&&c.y===a.y}))==null?void 0:a.length)!=null?b:0)>0);if(e&&a)return[d,"ACCEPTED"];else if(a)return[d,"REJECTED"];return[d,"IGNORED"]}function a(a,c,d){var e,f=c.mediaAttachments;if(!f)return;e=(e=c.productTagEvaluationData)!=null?e:new Map();var i=function(){if(k){if(l>=j.length)return"break";m=j[l++]}else{l=j.next();if(l.done)return"break";m=l.value}var e=m,i=e[0];e=e[1];var n=f.find(function(a){return a.data.id===i});if(!n||n.fileType!=="PHOTO"||n.state!=="UPLOADED")return{v:void 0};var o=new Set();e.forEach(function(e){var f,j,k,l=e.userAction,m=e.confidence,p=e.productID;f=(f=n==null?void 0:(f=n.data)==null?void 0:f.tags)!=null?f:[];j=(j=(j=c.surfacedKnownAIProductTags)==null?void 0:j.get(i))!=null?j:[];k=(k=(k=c.surfacedUnknownAIProductTags)==null?void 0:k.get(i))!=null?k:[];if(m==="HIGH")l=g(f,j,e,d);else if(m==="LOW"){j=h(f,k,e);m=j[0];f=j[1];p=m;l=f}o.add(p);b("ProductTaggingAiEvaluationFalcoEvent").log(function(){return{bounding_box:e.boundingBoxJSON,box_score:e.boxScore,category_id:null,center_x:e.x/100,center_y:e.y/100,confidence:e.confidence,page_id:a,photo_id:i,platform:"comet",product_id:p,product_score:e.productScore,referral_source:"composer",user_action_type:l}})});e=n==null?void 0:(e=n.data)==null?void 0:e.tags;e==null?void 0:e.filter(function(a){return!o.has(a==null?void 0:a.taggee.id)}).forEach(function(c){if(!c)return;b("ProductTaggingAiEvaluationFalcoEvent").log(function(){return{bounding_box:null,box_score:null,category_id:null,center_x:c.x/100,center_y:c.y/100,confidence:null,page_id:a,photo_id:i,platform:"comet",product_id:c==null?void 0:c.taggee.id,product_score:null,referral_source:"composer",user_action_type:"USER_GENERATED"}})})};_loop:for(var j=e,k=Array.isArray(j),l=0,j=k?j:j[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var m;e=i();switch(e){case"break":break _loop;default:if(typeof e==="object")return e.v}}}}),null);
__d("ProductTagConfidence",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum").Mirrored(["HIGH","LOW"]);c=a;e.exports=c}),null);
__d("CometPhotoEditorAIProductTagReducer",["ProductTagConfidence","ProductTagUserActionType","addToMap","removeFromMap"],(function(a,b,c,d,e,f){"use strict";e.exports=a;function g(a,b){return a.map(function(a){return{boundingBoxJSON:a.boundingBoxJSON,boxScore:a.boxScore,confidence:b,productID:a.productID,productScore:a.productScore,userAction:"IGNORED",x:a.x,y:a.y}})}function a(a,c){switch(c.type){case"SET_AI_SUGGESTED_PRODUCT_TAGS":var d,e=[].concat(g(c.aiSuggestedProductTags.knownSuggestions,"HIGH"),g(c.aiSuggestedProductTags.unknownSuggestions,"LOW"));e=babelHelpers["extends"]({},a,{knownAIProductTags:b("addToMap")((d=a.knownAIProductTags)!=null?d:new Map(),c.mediaID,c.aiSuggestedProductTags.knownSuggestions),productTagEvaluationData:b("addToMap")((d=a.productTagEvaluationData)!=null?d:new Map(),c.mediaID,e),unknownAIProductTags:b("addToMap")((d=a.unknownAIProductTags)!=null?d:new Map(),c.mediaID,c.aiSuggestedProductTags.unknownSuggestions)});return e;case"SET_IS_READY_FOR_AI_SUGGESTED_PRODUCT_TAGS":return babelHelpers["extends"]({},a,{isReadyForAISuggestedProductTags:((d=a.isReadyForAISuggestedProductTags)==null?void 0:d.includes(c.mediaID))?a.isReadyForAISuggestedProductTags:[].concat((e=a.isReadyForAISuggestedProductTags)!=null?e:[],[c.mediaID])});case"SET_IS_AI_SUGGESTED_TOOLTIP_DISMISSED":return babelHelpers["extends"]({},a,{isAISuggestedTooltipDismissed:c.isDismissed});case"REMOVE_AI_SUGGESTED_TAG":d=a.knownAIProductTags;if(!d)return a;e=d.get(c.mediaID);return e===void 0?a:babelHelpers["extends"]({},a,{knownAIProductTags:b("addToMap")(b("removeFromMap")(d,c.mediaID),c.mediaID,e.filter(function(a){return(a==null?void 0:(a=a.taggee)==null?void 0:a.id)!==c.tagIDToDelete}))});case"SURFACED_AI_SUGGESTED_KNOWN_TAG":e=(d=a.surfacedKnownAIProductTags)!=null?d:new Map();d=(d=e.get(c.mediaID))!=null?d:[];return babelHelpers["extends"]({},a,{surfacedKnownAIProductTags:b("addToMap")(b("removeFromMap")(e,c.mediaID),c.mediaID,d.includes(c.tagID)?d:[].concat(d,[c.tagID]))});case"SURFACED_AI_SUGGESTED_UNKNOWN_TAG":d=(e=a.surfacedUnknownAIProductTags)!=null?e:new Map();e=(e=d.get(c.mediaID))!=null?e:[];var f=e.filter(function(a){return a.x===c.x&&a.y===c.y}).length>0;return babelHelpers["extends"]({},a,{surfacedUnknownAIProductTags:b("addToMap")(b("removeFromMap")(d,c.mediaID),c.mediaID,f?e:[].concat(e,[{x:c.x,y:c.y}]))})}return a}}),null);
__d("CometPhotoEditorAIProductTagSuggestions.react",["CometAIProductTagSuggestionsUtil.react","CometComposerProductTagUtils","CometRelay","React","useComposerViewStateDispatcher","withComposerViewStatePart"],(function(a,b,c,d,e,f){"use strict";var g=b("React");function a(a){var c=a.aiSuggestionsQuery,d=a.isProfileComposer,e=a.isReadyForAISuggestedProductTags,f=a.knownAIProductTags,h=a.mediaAttachments;a=a.queryReference;var i=b("useComposerViewStateDispatcher")(),j=(h||[]).map(function(a){var b;return!(f==null?void 0:f.has((b=a==null?void 0:(b=a.data)==null?void 0:b.id)!=null?b:""))&&(e==null?void 0:e.includes((b=a==null?void 0:(b=a.data)==null?void 0:b.id)!=null?b:""))===!0?a:null}),k=g.useCallback(function(a,c,e){var f,g;f=c==null?void 0:(f=c.data)==null?void 0:f.id;if(a!=null&&(((g=c.data)==null?void 0:g.tags)==null||((g=(g=c.data)==null?void 0:g.tags)!=null?g:[]).length===0)&&f!==void 0&&f!==null){if(b("CometAIProductTagSuggestionsUtil.react").canUsePretagExperience(d)){(g=a.knownSuggestions)==null?void 0:g.map(function(a){if(a.productID===void 0||a.productID===null||a.productScore===void 0||a.productScore===null||a.productScore>b("CometComposerProductTagUtils").PRETAGGING_PRODUCT_THRESHOLD)return;if(c.state==="UPLOADED"&&c.fileType==="PHOTO"){var d,f=babelHelpers["extends"]({},c);d=[].concat((d=c.data.tags)!=null?d:[],[{source:"AI_suggested",taggee:{id:a.productID,image_uri:a.taggee.image_uri,name:a.taggee.name,product_price:a.taggee.product_price,taggee_type:"PRODUCT_ITEM"},x:a.x,y:a.y}]);f.data.tags=d;i({index:e,media:f,type:"SAVE_MEDIA_EDITS"})}})}(a.knownSuggestions.length!==0||a.unknownSuggestions.length!==0)&&i({isDismissed:!1,type:"SET_IS_AI_SUGGESTED_TOOLTIP_DISMISSED"});i({aiSuggestedProductTags:a,mediaID:f,type:"SET_AI_SUGGESTED_PRODUCT_TAGS"})}},[i,d]),l=b("CometRelay").usePreloadedQuery(c,a),m=g.useCallback(function(){if(j.filter(Boolean).length>0){var a=b("CometAIProductTagSuggestionsUtil.react").processAIProductTagSuggestionsQueryResponse(l);j.forEach(function(b,c){if(b===null)return;var d=b.data.id;d!=null&&a.has(d)&&k(a.get(d),b,c)})}},[j,l,k]);g.useEffect(function(){m()},[m]);return null}c=b("withComposerViewStatePart")(a,function(a){return{isReadyForAISuggestedProductTags:a.isReadyForAISuggestedProductTags,knownAIProductTags:a.knownAIProductTags,mediaAttachments:a.mediaAttachments}});e.exports=c}),null);
__d("CometPhotoEditorAIProductTagSuggestionTrigger.react",["Actor","CometAIProductTagSuggestionsQuery.react","CometPhotoEditorAIProductTagReducer","CometPhotoEditorAIProductTagSuggestions.react","CometRelay","React","useComposerViewStateDispatcher","useComposerViewStateReducer","withComposerViewStatePart","CometPhotoEditorAIProductTagSuggestionTriggerQuery.graphql"],(function(a,b,c,d,e,f){"use strict";var g,h=b("React");function a(a){var c,d=a.isProfileComposer,e=a.isReadyForAISuggestedProductTags,f=a.knownAIProductTags,i=a.mediaAttachments;a=b("Actor").useActor();a=a[0];b("useComposerViewStateReducer")(b("CometPhotoEditorAIProductTagReducer"));var j=b("useComposerViewStateDispatcher")();a=b("CometRelay").useLazyLoadQuery(g!==void 0?g:g=b("CometPhotoEditorAIProductTagSuggestionTriggerQuery.graphql"),{actorID:a});c=Boolean(a==null?void 0:(c=a.page)==null?void 0:c.has_taggable_products);var k=Boolean(a==null?void 0:a.additional_profile_shop_info),l=c||k,m=Boolean(a==null?void 0:(c=a.page)==null?void 0:c.has_shared_catalog_segments),n=h.useCallback(function(){l&&!m&&(i||[]).map(function(a){return a.state==="UPLOADED"&&a.fileType==="PHOTO"&&!(f==null?void 0:f.has(a.data.id))&&!(e==null?void 0:e.includes(a.data.id))?j({isReady:!0,mediaID:a==null?void 0:(a=a.data)==null?void 0:a.id,type:"SET_IS_READY_FOR_AI_SUGGESTED_PRODUCT_TAGS"}):null}).filter(Boolean)},[l,m,i,f,e,j]);k=b("CometRelay").useQueryLoader(b("CometAIProductTagSuggestionsQuery.react"));a=k[0];var o=k[1];h.useEffect(function(){n();var a=(i||[]).map(function(a){var b;return!(f==null?void 0:f.has((b=a.data.id)!=null?b:""))&&(e==null?void 0:e.includes(a.data.id))?a.data.id:null}).filter(Boolean);a!==null&&o({max_suggestions_per_photo:1,photo_ids:a})},[n,e,f,o,i]);return a!=null?h.jsx(b("CometPhotoEditorAIProductTagSuggestions.react"),{aiSuggestionsQuery:b("CometAIProductTagSuggestionsQuery.react"),isProfileComposer:d,queryReference:a}):null}c=b("withComposerViewStatePart")(a,function(a){return{isReadyForAISuggestedProductTags:a.isReadyForAISuggestedProductTags,knownAIProductTags:a.knownAIProductTags,mediaAttachments:a.mediaAttachments}});e.exports=c}),null);